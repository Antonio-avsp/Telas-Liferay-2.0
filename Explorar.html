<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorar</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>

    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-icon">
                    <i class="fa-regular fa-heart"></i>
                </div>
                <span>Voluntariado<br><strong>Liferay</strong></span>
            </div>

            <nav class="navigation">
                <p>Navega√ß√£o</p>
                <ul>
                    <li><a href="inicio.html"><i class="fa-solid fa-house"></i> In√≠cio</a></li>
                    <li><a href="explorar.html" class="active"><i class="fa-solid fa-magnifying-glass"></i> Explorar</a></li>
                    <li><a href="criar-oportunidade.html"><i class="fa-solid fa-circle-plus"></i> Criar Oportunidade</a></li>
                    <li><a href="impacto.html"><i class="fa-solid fa-chart-line"></i> Impacto</a></li>
                    <li><a href="testemunhos.html"><i class="fa-solid fa-comments"></i> Testemunhos</a></li>
                    <li><a href="MeuPerfil.html"><i class="fa-solid fa-user"></i> Meu perfil</a></li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="avatar-small">R</div>
                    <div class="user-details">
                        <strong>Rafael</strong>
                        <span>0h de voluntariado</span>
                    </div>
                </div>
                <button class="logout-button">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i> Sair
                </button>
            </div>
        </aside>

        <main class="main-content">
            
            <div class="explore-header">
                <h1>Explorar Oportunidades</h1>
                <p>Encontre a causa perfeita para voc√™</p>
            </div>

            <div class="filter-bar">
                <div class="search-box">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" placeholder="Buscar por t√≠tulo, descri√ß√£o ou organiza√ß√£o...">
                </div>
                <button class="filter-button">
                    <i class="fa-solid fa-filter"></i>
                    Filtrar
                </button>
            </div>

            <section class="opportunity-grid" id="grid-oportunidades">

                <div class="opportunity-card">
                    <img src="images/explorar-pintura.jpeg" alt="Mutir√£o de pintura">
                    <div class="card-content">
                        <span class="tag tag-blue">Pintura</span>
                        <h3>Mutir√£o de pintura - Escola Municipal</h3>
                        <p>Vamos nos reunir no fim de semana para pintar o muro da escola uma √≥tima oportunidade para quem quer ter o impacto...</p>
                        <div class="card-info">
                            <span><i class="fa-solid fa-building"></i>  Instituto Educa√ß√£o para Todos</span>
                            <span><i class="fa-solid fa-location-dot"></i> Recife </span>
                            <span><i class="fa-solid fa-calendar-days"></i> 14 de Fevereiro</span>
                            <span><i class="fa-regular fa-clock"></i> 08:00</span>
                        </div>
                        <a href="explorar-detalhe.html?id=pintura" class="details-button">Ver detalhes</a>
                        <a href="#" class="inscricao-btn-explorar" onclick="alert('Este √© um card de exemplo. Crie uma oportunidade real para testar a inscri√ß√£o!')"><i class="fa-regular fa-heart"></i> Inscreva-se</a>
                    </div>
                </div>

                <div class="opportunity-card">
                    <img src="images/explorar-plantio.jpeg" alt="Plantio de √Årvores">
                    <div class="card-content">
                        <span class="tag tag-green">Meio ambiente</span>
                        <h3>Plantio de √°rvores - Parque Ecol√≥gico</h3>
                        <p>Participe de um dia incr√≠vel de reflorestamento em um parque... esta a√ß√£o visa... o local.</p>
                        <div class="card-info">
                            <span><i class="fa-solid fa-building"></i>  SOS Mata Atlantica</span>
                            <span><i class="fa-solid fa-location-dot"></i> S√£o Paulo</span>
                            <span><i class="fa-solid fa-calendar-days"></i> 21 de Fevereiro</span>
                            <span><i class="fa-regular fa-clock"></i> 07:00</span>
                        </div>
                        <a href="explorar-detalhe.html?id=plantio" class="details-button">Ver detalhes</a>
                        <a href="#" class="inscricao-btn-explorar" onclick="alert('Este √© um card de exemplo. Crie uma oportunidade real para testar a inscri√ß√£o!')"><i class="fa-regular fa-heart"></i> Inscreva-se</a>
                    </div>
                </div>

                <div class="opportunity-card">
                    <img src="images/explorar-programacao.jpeg" alt="Aulas de Programa√ß√£o">
                    <div class="card-content">
                        <span class="tag tag-purple">Educa√ß√£o</span>
                        <h3>Aulas de Programa√ß√£o para Jovens</h3>
                        <p>Ensine conceitos b√°sicos de programa√ß√£o para jovens... Python, JavaScript... futuro desses jovens.</p>
                        <div class="card-info">
                            <span><i class="fa-solid fa-building"></i> Code.org Brasil</span>
                            <span><i class="fa-solid fa-location-dot"></i> Online</span>
                            <span><i class="fa-solid fa-calendar-days"></i> 26 de Fevereiro</span>
                            <span><i class="fa-regular fa-clock"></i> 19:00</span>
                        </div>
                        <a href="explorar-detalhe.html?id=programacao" class="details-button">Ver detalhes</a>
                        <a href="#" class="inscricao-btn-explorar" onclick="alert('Este √© um card de exemplo. Crie uma oportunidade real para testar a inscri√ß√£o!')"><i class="fa-regular fa-heart"></i> Inscreva-se</a>
                    </div>
                </div>

                <div class="opportunity-card">
                    <img src="images/explorar-idosos.jpeg" alt="Visita ao lar de idosos">
                    <div class="card-content">
                        <span class="tag tag-yellow">Apoio social</span>
                        <h3>Visita ao lar de idosos</h3>
                        <p>Passe uma tarde agrad√°vel com os residentes... converse, jogue... traga sua companhia...</p>
                        <div class="card-info">
                            <span><i class="fa-solid fa-building"></i> Associa√ß√£o Vida Plena</span>
                            <span><i class="fa-solid fa-location-dot"></i> Recife</span>
                            <span><i class="fa-solid fa-calendar-days"></i> 01 de mar√ßo</span>
                            <span><i class="fa-regular fa-clock"></i> 15:00</span>
                        </div>
                        <a href="explorar-detalhe.html?id=idosos" class="details-button">Ver detalhes</a>
                        <a href="#" class="inscricao-btn-explorar" onclick="alert('Este √© um card de exemplo. Crie uma oportunidade real para testar a inscri√ß√£o!')"><i class="fa-regular fa-heart"></i> Inscreva-se</a>
                    </div>
                </div>

                <div class="opportunity-card">
                    <img src="images/explorar-arte.jpeg" alt="Oficina de arte">
                    <div class="card-content">
                        <span class="tag tag-red">Cultura</span>
                        <h3>Oficina de arte para as crian√ßas</h3>
                        <p>Conduza uma oficina de arte (pintura, desenho)... para crian√ßas de 7 a 10 anos. O objetivo √©...</p>
                        <div class="card-info">
                            <span><i class="fa-solid fa-building"></i> Arte na Periferia</span>
                            <span><i class="fa-solid fa-location-dot"></i> Rio de Janeiro</span>
                            <span><i class="fa-solid fa-calendar-days"></i> 03 de mar√ßo</span>
                            <span><i class="fa-regular fa-clock"></i> 09:00</span>
                        </div>
                        <a href="explorar-detalhe.html?id=arte" class="details-button">Ver detalhes</a>
                        <a href="#" class="inscricao-btn-explorar" onclick="alert('Este √© um card de exemplo. Crie uma oportunidade real para testar a inscri√ß√£o!')"><i class="fa-regular fa-heart"></i> Inscreva-se</a>
                    </div>
                </div>

                </section>
        </main>
    </div>
<script src="app.js"></script>

<script>
    // Fun√ß√£o principal que carrega as oportunidades do Banco de Dados
    async function carregarOportunidades() {
        try {
            const response = await fetch('/api/oportunidades');
            const oportunidades = await response.json();
            
            // Pega o grid onde j√° existem os cards est√°ticos (fict√≠cios)
            const grid = document.getElementById('grid-oportunidades'); 

            // N√ÉO usamos 'grid.innerHTML = ""' aqui, pois queremos manter os cards est√°ticos.
            // O forEach vai criar os novos e adicionar no FINAL da lista (append).

            oportunidades.forEach(op => {
                const card = document.createElement('div');
                card.className = 'opportunity-card';
                
                // 1. Formata√ß√£o da Data
                const dataObj = new Date(op.data_evento);
                const dataUser = new Date(dataObj.getTime() + dataObj.getTimezoneOffset() * 60000);
                const dataFormatada = dataUser.toLocaleDateString('pt-BR');

                // 2. Tratamento do Nome da ONG
                const nomeOng = op.instituicao ? op.instituicao.nomeInstituicao : 'ONG';

                // 3. HTML do Card (Incluindo a corre√ß√£o da Hora que voc√™ pediu)
                card.innerHTML = `
                    <img src="${op.imagem_url}" alt="${op.titulo}">
                    <div class="card-content">
                        <span class="tag tag-blue">Nova</span>
                        <h3>${op.titulo}</h3>
                        <p>${op.descricao ? op.descricao.substring(0, 100) + '...' : ''}</p>
                        
                        <div class="card-info">
                            <span><i class="fa-solid fa-building"></i> ${nomeOng}</span>
                            <span><i class="fa-solid fa-location-dot"></i> ${op.local_evento}</span>
                            <span><i class="fa-solid fa-calendar-days"></i> ${dataFormatada}</span>
                            <span><i class="fa-regular fa-clock"></i> ${op.horario}</span>
                        </div>

                        <a href="explorar-detalhe.html?id=${op.idoportunidade}" class="details-button">Ver detalhes</a>
                        
                        <button onclick="inscreverDinamicamente(${op.idoportunidade})" class="inscricao-btn-explorar">
                            <i class="fa-regular fa-heart"></i> Inscreva-se
                        </button>
                    </div>
                `;
                
                // Adiciona o novo card DEPOIS dos que j√° existem no HTML
                grid.appendChild(card);
            });
        } catch (error) { 
            console.error("Erro ao carregar oportunidades:", error); 
        }
    }

    // Fun√ß√£o de Inscri√ß√£o
    async function inscreverDinamicamente(id) {
         const userJson = localStorage.getItem('userData');
         if(!userJson) { 
             alert('Fa√ßa login para se inscrever!'); 
             window.location.href = 'login.html';
             return; 
         }
         const user = JSON.parse(userJson);
         
         if(confirm("Deseja se inscrever nesta oportunidade?")) {
             try {
                const response = await fetch('/api/inscricao', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ usuario_cpf: user.cpf, oportunidade_id: id })
                });
                const res = await response.json();
                if(response.ok) {
                    alert("Inscri√ß√£o realizada com sucesso! üéâ");
                } else {
                    alert(res.message);
                }
             } catch(e) {
                 console.error(e);
                 alert("Erro de conex√£o.");
             }
         }
    }

    document.addEventListener('DOMContentLoaded', carregarOportunidades);

</script>
</body>
</html>