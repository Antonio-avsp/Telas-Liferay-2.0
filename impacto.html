<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impacto Coletivo</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-icon"><i class="fa-regular fa-heart"></i></div>
                <span>Voluntariado<br><strong>Liferay</strong></span>
            </div>
            <nav class="navigation">
                <p>Navegação</p>
                <ul>
                    <li><a href="inicio.html"><i class="fa-solid fa-house"></i> Início</a></li>
                    <li><a href="explorar.html"><i class="fa-solid fa-magnifying-glass"></i> Explorar</a></li>
                    <li><a href="criar-oportunidade.html"><i class="fa-solid fa-circle-plus"></i> Criar Oportunidade</a></li>
                    <li><a href="impacto.html" class="active"><i class="fa-solid fa-chart-line"></i> Impacto</a></li>
                    <li><a href="testemunhos.html"><i class="fa-solid fa-comments"></i> Testemunhos</a></li>
                    <li><a href="MeuPerfil.html"><i class="fa-solid fa-user"></i> Meu perfil</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="MeuPerfil.html" class="user-info-link">
                    <div class="user-info">
                        <div class="avatar-small">...</div>
                        <div class="user-details">
                            <strong>Carregando...</strong>
                            <span id="sidebar-horas">0h de voluntariado</span>
                        </div>
                    </div>
                </a>
                <button class="logout-button">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i> Sair
                </button>
            </div>
        </aside>

        <main class="main-content">
            
           <div class="page-header">
                <div> 
                    <h1>Impacto coletivo</h1> 
                    <p>O poder da colaboração Liferay criando mundos e comunidades</p> 
                </div> 
            </div>

            <section class="stats-grid">
                <div class="stat-card">
                    <div class="card-header"><span>Horas Totais</span><i class="fa-solid fa-clock icon-blue"></i></div>
                    <span class="stat-value" id="imp-horas">0h</span>
                </div>
                <div class="stat-card">
                    <div class="card-header"><span>Voluntários Ativos</span><i class="fa-solid fa-users icon-green"></i></div>
                    <span class="stat-value" id="imp-voluntarios">0</span>
                </div>
                <div class="stat-card">
                    <div class="card-header"><span>Atividades Concluídas</span><i class="fa-solid fa-check-circle icon-teal"></i></div>
                    <span class="stat-value" id="imp-concluidas">0</span>
                </div>
                <div class="stat-card">
                    <div class="card-header"><span>Oportunidades Criadas</span><i class="fa-solid fa-chart-bar icon-purple"></i></div>
                    <span class="stat-value" id="imp-criadas">0</span>
                </div>
            </section>

            <nav class="impact-tabs">
                <button class="tab-button active" id="tab-visao-geral"><i class="fa-solid fa-chart-pie"></i> Visão geral</button>
                <button class="tab-button" id="tab-voluntarios"><i class="fa-solid fa-users"></i> Voluntários</button>
                <button class="tab-button" id="tab-categorias"><i class="fa-solid fa-tags"></i> Categorias</button>
                <button class="tab-button" id="tab-geografia"><i class="fa-solid fa-map-marked-alt"></i> Geografia</button>
            </nav>

            <div id="content-visao-geral" class="tab-content">
                <section class="charts-container">
                    <div class="chart-card">
                        <h2>Horas de Voluntariado (Últimos 6 Meses)</h2>
                        <canvas id="graficoHoras"></canvas>
                    </div>
                    <div class="chart-card">
                        <h2>Voluntários Ativos (Últimos 6 Meses)</h2>
                        <canvas id="graficoVoluntarios"></canvas>
                    </div>
                </section>
            </div>

            <div id="content-voluntarios" class="tab-content hidden">
                <div class="chart-card">
                    <h2>Top Voluntários Mais Engajados</h2>
                    <ul class="impacto-geo-list" id="lista-top-voluntarios">
                        </ul>
                </div>
            </div>

            <div id="content-categorias" class="tab-content hidden">
                <section class="charts-container">
                    <div class="chart-card">
                        <h2>Distribuição por Categoria</h2>
                        <div style="height:250px; display:flex; justify-content:center;">
                            <canvas id="graficoCategoriaPizza"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h2>Detalhamento</h2>
                        <ul class="detalhamento-list" id="lista-categorias-detalhe"></ul>
                    </div>
                </section>
            </div>

            <div id="content-geografia" class="tab-content hidden">
                <section class="charts-container">
                    <div class="chart-card">
                        <h2>Cidades Impactadas</h2>
                        <ul class="impacto-geo-list" id="lista-geografia"></ul>
                    </div>
                    <div class="chart-card">
                        <h2>Resumo de Alcance</h2>
                        <div class="resumo-geo-card">
                            <span>Cidades Físicas</span>
                            <strong id="geo-total-cidades">0</strong>
                        </div>
                         <div class="resumo-geo-card">
                            <span>Atividades Online</span>
                            <strong id="geo-total-online">0</strong>
                        </div>
                        <div class="resumo-alcance">
                            <strong>Alcance Global</strong>
                            <p>Nosso voluntariado está quebrando fronteiras!</p>
                        </div>
                    </div>
                </section>
            </div>

            <section class="banner-impact">
                <i class="fa-solid fa-handshake-angle"></i>
                <h2>Juntos somos mais fortes</h2>
            </section>

            <section class="values-grid">
                <div class="value-card">
                    <div class="icon-circle"><i class="fa-solid fa-heart-pulse"></i></div>
                    <h3>Impacto real</h3>
                    <p>Cada hora dedicada transforma vidas e fortalece comunidades</p>
                </div>
                <div class="value-card">
                    <div class="icon-circle"><i class="fa-solid fa-people-group"></i></div>
                    <h3>Cultura de colaboração</h3>
                    <p>Unidos pela causa comum de fazer a diferença</p>
                </div>
                <div class="value-card">
                    <div class="icon-circle"><i class="fa-solid fa-chart-line"></i></div>
                    <h3>Crescimento contínuo</h3>
                    <p>Expandindo nosso impacto social mês após mês</p>
                </div>
            </section>

        </main>
    </div>
    
    <script src="app.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            
            // 1. LÓGICA DO SISTEMA DE ABAS
            // Alterna a visibilidade das divs de conteúdo e estilo dos botões
            const tabs = ['visao-geral', 'voluntarios', 'categorias', 'geografia'];
            tabs.forEach(t => {
                document.getElementById(`tab-${t}`).addEventListener('click', () => {
                    // Esconde todos
                    tabs.forEach(x => {
                        document.getElementById(`content-${x}`).classList.add('hidden');
                        document.getElementById(`tab-${x}`).classList.remove('active');
                    });
                    // Mostra o clicado
                    document.getElementById(`content-${t}`).classList.remove('hidden');
                    document.getElementById(`tab-${t}`).classList.add('active');
                });
            });

            // 2. CARREGAMENTO DE DADOS (FETCH API)
            try {
                const response = await fetch('/api/impacto-global');
                const dados = await response.json();

                // A. Atualiza KPIs do Topo
                document.getElementById('imp-horas').textContent = dados.totais.horasTotais + 'h';
                document.getElementById('imp-voluntarios').textContent = dados.totais.voluntariosUnicos;
                document.getElementById('imp-concluidas').textContent = dados.totais.atividadesConcluidas;
                document.getElementById('imp-criadas').textContent = dados.totais.oportunidadesCriadas;

                // B. Configura Gráficos (Chart.js)
                // Gráfico de Barras (Horas)
                new Chart(document.getElementById('graficoHoras'), {
                    type: 'bar',
                    data: {
                        labels: dados.mensal.labels,
                        datasets: [{ 
                            label: 'Horas', 
                            data: dados.mensal.horas, 
                            backgroundColor: '#007bff' 
                        }]
                    }
                });
                // Gráfico de Linha (Voluntários)
                new Chart(document.getElementById('graficoVoluntarios'), {
                    type: 'line',
                    data: {
                        labels: dados.mensal.labels,
                        datasets: [{ 
                            label: 'Novos Voluntários', 
                            data: dados.mensal.voluntarios, 
                            borderColor: '#28a745', 
                            tension: 0.3 
                        }]
                    }
                });

                // C. Preenche Lista de Ranking
                const listaVol = document.getElementById('lista-top-voluntarios');
                if (dados.ranking.length === 0) listaVol.innerHTML = '<li>Nenhum dado ainda.</li>';
                dados.ranking.forEach((v, i) => {
                    // Ícone de medalha dourada para o 1º lugar
                    const icone = i === 0 ? 'gold' : '#ccc';
                    listaVol.innerHTML += `<li><i class="fa-solid fa-medal" style="color:${icone}"></i> <strong>${v.nome}</strong> <span style="margin-left:auto">${v.qtd} participações</span></li>`;
                });

                // D. Gráfico de Pizza (Categorias)
                const cores = ['#007bff', '#28a745', '#ffc107', '#dc3545', '#6f42c1'];
                new Chart(document.getElementById('graficoCategoriaPizza'), {
                    type: 'doughnut',
                    data: {
                        labels: dados.categorias.map(c => c.nome),
                        datasets: [{ 
                            data: dados.categorias.map(c => c.quantidade), 
                            backgroundColor: cores 
                        }]
                    },
                    options: { 
                        maintainAspectRatio: false, 
                        plugins: { legend: { position: 'bottom' } } 
                    }
                });
                
                // Lista detalhada de categorias
                const listaCat = document.getElementById('lista-categorias-detalhe');
                dados.categorias.forEach((c, i) => {
                    listaCat.innerHTML += `<li><span class="detalhe-cor" style="background:${cores[i%5]}"></span> <strong>${c.nome}</strong> <span style="margin-left:auto">${c.quantidade} un.</span></li>`;
                });

                // E. Dados Geográficos
                const listaGeo = document.getElementById('lista-geografia');
                dados.geografia.cidades.forEach(c => {
                    listaGeo.innerHTML += `<li><i class="fa-solid fa-location-dot"></i> <strong>${c.cidade}</strong> <span style="margin-left:auto">${c.count} oportunidades</span></li>`;
                });
                document.getElementById('geo-total-cidades').textContent = dados.geografia.cidades.length;
                document.getElementById('geo-total-online').textContent = dados.geografia.online;

            } catch (error) { 
                console.error("Erro ao carregar impacto:", error); 
            }
        });
    </script>
</body>
</html>